######################## CHAT-GPT-3.5


function generateProductDescriptions() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const lastRow = sheet.getLastRow();
  
  for (let i = 2; i <= lastRow; i++) {
    const productName = sheet.getRange(`B${i}`).getValue();
    const characteristics = sheet.getRange(`C${i}`).getValue();
    const descriptionCell = sheet.getRange(`F${i}`);
    
    if (productName && characteristics && !descriptionCell.getValue()) {
      const prompt = `
      Напиши текст с уникальностью не менее 95% для коммерческой страницы - карточки товара интернет-магазина "Pechka-Shop".
Текст должен быть объёмом в 1500 символов.
В тексте не должно быть спама ключевых фраз (частого употребления одного и того же ключа - например, названия товаров).
Текст не должен быть "приукрашен" - пишем только по делу. Текст должен раскрывать семантический граф и интент запроса основного ключа.

Название товара - Основной ключ (название темы) : ${productName}.
Основные характеристики товара: ${characteristics}.

В тексте необходимо использовать следующие ключевые фразы:
[название товара] - 2-3 вхождения;
купить - 1 раз;
цена - 1 раз;
стоимость - 1 раз; 
интернет-магазин - 1 раз;
санкт-петербург (Спб) - 1 раз;
недорого - 1 раз;

!Важно: употребить фразы в указанном колличестве, но не более. 

Структура текста:
1. О изделии 
!Важно: не задавать заголовок в тексте. Каждый текст начинается без h1.
!Важно: здесь текст должен состоять из 2-х объёмных абзацев
	- кратко о производитиле (кратко);
	- что это: из чего состоит
2. Особенности и преимущества изделия 
	- важные особенности
	- важные преимущества 

!Нельзя писать о том, что нужно проконсультироваться со специалистом. 
      `;
      const generatedDescription = callOpenAI(prompt);
      descriptionCell.setValue(generatedDescription);
    }
  }
}

function callOpenAI(prompt) {
  const apiKey = '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';
  
  const response = UrlFetchApp.fetch('https://api.openai.com/v1/chat/completions', {
    method: 'post',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${apiKey}`
    },
    payload: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [
        {role: "system", content: "You are a helpful assistant."},
        {role: "user", content: prompt}
      ],
      max_tokens: 300
    })
  });









######################## CHAT-GPT-4

  const result = JSON.parse(response.getContentText());
  return result.choices[0].message.content.trim();
}
